# Story 3.4 E2E Test: Delete Meal Flow
# Tests deleting meal entry with confirmation
#
# Acceptance Criteria Validated:
# - User can delete meal entry
# - Confirmation dialog appears
# - Meal removed from list

appId: com.foodie.app
---
# Launch app
- launchApp:
    clearState: false

# Dismiss onboarding if present
- runFlow: flows/dismiss-onboarding.yaml

# Wait for meal list
- assertVisible: "Foodie"

# NOTE: This test requires at least one meal exists
- assertVisible:
    text: ".*kcal.*"

# ============================================
# Navigate to Meal Detail
# ============================================

# Tap first meal
- tapOn:
    text: ".*kcal.*"
    index: 0

# Wait for detail screen
- assertVisible:
    text: ".*"

# ============================================
# Initiate Delete
# ============================================

# Tap delete button
- tapOn:
    id: "deleteButton"

# ============================================
# Confirm Deletion
# ============================================

# Verify confirmation dialog appears
- assertVisible: "Delete Entry"
- assertVisible: "Delete this entry?"
- assertVisible: "Cancel"
- assertVisible: "Delete"

# Test cancel button (negative path)
- tapOn: "Cancel"

# Should still be on detail screen
- assertVisible:
    text: ".*"

# Initiate delete again
- tapOn:
    id: "deleteButton"

# Confirm deletion
- tapOn: "Delete"

# ============================================
# Verify Deletion Success
# ============================================

# Should return to meal list
- assertVisible: "Foodie"

# Pull to refresh
- scroll:
    direction: DOWN

# ============================================
# Verify Persistence
# ============================================

# Restart app
- pressKey: HOME
- stopApp
- launchApp

# Dismiss onboarding if present
- runFlow: flows/dismiss-onboarding.yaml

# Meal list should load
- assertVisible: "Foodie"

# ============================================
# SUCCESS CRITERIA
# ============================================

# ✅ Test passes if:
# 1. Delete button triggered confirmation dialog
# 2. Cancel button preserved meal (negative test)
# 3. Delete button removed meal from list
# 4. Deletion persisted after app restart
# 5. No errors or crashes

# ⚠️ Manual validation required:
# - Verify meal deleted from Google Fit
# - Check Health Connect app shows deletion
# - Verify no orphaned data in HC database
