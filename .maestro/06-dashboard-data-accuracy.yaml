# Story 6.6 E2E Test: Dashboard Data Accuracy
# Priority: P1 (High - Core feature validation)
#
# Acceptance Criteria Validated:
# - Dashboard displays Calories In from Health Connect
# - Dashboard displays Calories Out (TDEE calculation)
# - Dashboard shows Deficit/Surplus correctly
# - Green card for deficit, red card for surplus
# - Real-time updates when meals logged

appId: com.foodie.app
---
# ============================================
# SETUP: Ensure prerequisites met
# ============================================

- launchApp:
    clearState: false

# Note: This test assumes:
# 1. User profile configured (Story 6.1)
# 2. At least one meal logged (for Calories In)
# 3. Health Connect has step data (for NEAT calculation)

# ============================================
# PHASE 1: Navigate to Dashboard
# ============================================

# Tap dashboard navigation button
- tapOn:
    id: "dashboard_nav_button"
    text: "Dashboard"
    optional: true  # Either id or text should work

# Verify dashboard screen loaded
- assertVisible: "Energy Balance"

# ============================================
# PHASE 2: Verify TDEE Display
# ============================================

# TDEE = BMR + NEAT + Active Calories
# Should be displayed as "X kcal"
- assertVisible:
    text: "Calories Out"

- assertVisible:
    text: "\\d+\\s*kcal"  # Regex for any number + "kcal"

# ============================================
# PHASE 3: Verify Calories In Display
# ============================================

# Sum of all meals from Health Connect today
- assertVisible:
    text: "Calories In"

- assertVisible:
    text: "\\d+\\s*kcal"  # Should show total calories consumed

# ============================================
# PHASE 4: Verify Deficit/Surplus Calculation
# ============================================

# Deficit/Surplus = Calories Out - Calories In
- assertVisible:
    text: "(Deficit|Surplus)"

# Should show value with sign
- assertVisible:
    text: "[-+]?\\d+\\s*kcal"

# ============================================
# PHASE 5: Verify Color Coding
# ============================================

# Note: Maestro cannot directly verify colors
# But we can verify the cards/components exist

# If deficit (negative), should use green theme
# If surplus (positive), should use red theme

# ============================================
# PHASE 6: Verify Real-time Updates
# ============================================

# Navigate back to meal list
- pressKey: BACK

# Add a new meal (or edit existing)
- tapOn:
    id: "camera_fab"
    optional: true

# Note: Actually capturing a meal is complex (requires camera)
# Skip this part and assume meal already exists

# Navigate back to dashboard
- tapOn:
    id: "dashboard_nav_button"
    text: "Dashboard"
    optional: true

# Pull to refresh
- swipe:
    direction: DOWN
    duration: 500

# Values should update (can't verify exact numbers without state)

# ============================================
# PHASE 7: Verify TDEE Breakdown (Optional)
# ============================================

# Expand TDEE breakdown card
- tapOn:
    text: "TDEE Breakdown"
    optional: true

# Should show components
- assertVisible:
    text: "BMR"
    optional: true

- assertVisible:
    text: "NEAT"
    optional: true

- assertVisible:
    text: "Active"
    optional: true

# ============================================
# SUCCESS CRITERIA
# ============================================

# ✅ Test passes if:
# 1. Dashboard screen accessible
# 2. Calories Out displayed with value
# 3. Calories In displayed with value
# 4. Deficit/Surplus displayed with sign
# 5. No crashes or errors

# ⚠️ Manual validation required:
# - Verify TDEE calculation accuracy with known profile
# - Compare with Google Fit data
# - Verify color coding (green deficit, red surplus)
# - Test with 0 meals (empty state)
# - Test with multiple meals logged throughout day
