# Story 3.2/3.3 E2E Test: Edit Meal Flow
# Tests editing existing meal entry
#
# Acceptance Criteria Validated:
# - User can view and edit meal details
# - Changes save to Health Connect
# - Updated data appears immediately

appId: com.foodie.app
---
# Launch app
- launchApp:
    clearState: false

# Dismiss onboarding if present
- runFlow: flows/dismiss-onboarding.yaml

# Wait for meal list to load
- assertVisible: "Foodie"

# Find any existing meal
# NOTE: This test requires at least one meal in Health Connect
- assertVisible:
    text: ".*kcal.*"

# ============================================
# Open Meal Detail
# ============================================

# Tap first meal to open detail view
- tapOn:
    text: ".*kcal.*"
    index: 0

# Wait for detail screen to load
# Screen shows meal description as title
- assertVisible:
    text: ".*"

# ============================================
# Edit Meal Data
# ============================================

# Tap calories field and edit value
- tapOn:
    id: "caloriesField"

- eraseText
- inputText: "999"

# Tap description field and edit value
- tapOn:
    id: "descriptionField"

- eraseText
- inputText: "E2E Test Meal Edited"

# ============================================
# Save Changes
# ============================================

# Tap save button
- tapOn:
    id: "saveButton"

# ============================================
# Verify Changes Persisted
# ============================================

# Should return to meal list
- assertVisible: "Foodie"

# Updated meal should appear with new values
- assertVisible: "E2E Test Meal Edited"
- assertVisible: "999"

# ============================================
# Verify Persistence After Restart
# ============================================

# Restart app
- pressKey: HOME
- stopApp
- launchApp

# Dismiss onboarding if present
- runFlow: flows/dismiss-onboarding.yaml

# Changes should still be visible
- assertVisible: "E2E Test Meal Edited"
- assertVisible: "999"

# ============================================
# CLEANUP: Delete test meal
# ============================================

# Tap edited meal
- tapOn: "E2E Test Meal Edited"

# Tap delete button
- tapOn:
    id: "deleteButton"

# Confirm deletion
- tapOn: "Delete"

# Verify meal removed
- assertNotVisible: "E2E Test Meal Edited"

# ============================================
# SUCCESS CRITERIA
# ============================================

# ✅ Test passes if:
# 1. Meal detail screen opened
# 2. Calories and description edited
# 3. Changes saved without errors
# 4. Updated values appeared in list
# 5. Changes persisted after app restart
# 6. Cleanup successful

# ⚠️ Manual validation required:
# - Check Google Fit app shows updated calories
# - Verify HC data integrity with WRITE_NUTRITION permission
