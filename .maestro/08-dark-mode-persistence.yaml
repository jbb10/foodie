# Story 5.4 E2E Test: Dark Mode Persistence
# Tests theme preference selection and persistence across app restarts
#
# Acceptance Criteria Validated:
# - AC #7: In-app theme selector with "System Default", "Light", "Dark" options
# - AC #8: Theme preference persists across app restarts

appId: com.foodie.app
---
# Launch app
- launchApp:
    clearState: false

# Dismiss onboarding if present
- runFlow: flows/dismiss-onboarding.yaml

# Navigate to Settings
- runFlow: flows/open-settings.yaml

# Scroll to Appearance section
- scroll

# Verify Theme preference section exists
- assertVisible: "Theme"

# Select Dark theme
- tapOn: "Dark"

# Verify Settings screen still visible (theme applied immediately)
- assertVisible: "Settings"

# Navigate back to main screen
- pressKey: BACK

# Verify main screen visible with dark theme applied
- assertVisible: "Foodie"

# Restart app to test persistence
- pressKey: HOME
- stopApp
- launchApp

# Dismiss onboarding again if needed
- runFlow: flows/dismiss-onboarding.yaml

# Navigate back to Settings
- runFlow: flows/open-settings.yaml

# Scroll to theme section
- scroll

# Verify Dark theme still selected (radio button checked)
# Note: Maestro checks text visibility, actual radio state is visual
- assertVisible: "Dark"

# Switch to Light theme
- tapOn: "Light"

# Verify Settings screen still visible
- assertVisible: "Settings"

# Navigate back
- pressKey: BACK

# Verify main screen visible
- assertVisible: "Foodie"

# Test System Default option
- runFlow: flows/open-settings.yaml

- scroll

- tapOn: "System Default"

- assertVisible: "Settings"

- pressKey: BACK

# Final restart to verify System Default persists
- pressKey: HOME
- stopApp
- launchApp

- runFlow: flows/dismiss-onboarding.yaml

- runFlow: flows/open-settings.yaml

- scroll

# Verify System Default is selected
- assertVisible: "System Default"

# Cleanup: Set back to System Default
- tapOn: "System Default"

- pressKey: BACK
